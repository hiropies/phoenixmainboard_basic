# robot_cmd

<p align='right'>neozng1@hnu.edu.cn</p>

### 実行手順

実行時の流れは `RobotCMDTask()` から非常に直感的に視覚化できる。

1. まず、メッセージ購読メカニズムを通して他のアプリケーションからのフィードバックを取得する。
2. CalcOffsetAngle()`を使用してシャーシとジンバルのオフセット角度を計算する（シャーシが常に現在の正方向を通知されるようにする）。
3. キーボード、マウス、リモートコントロールのいずれで制御されているかに応じて対応する関数を呼び出し、制御コマンドを特定の制御情報に数値化する。
4. 制御情報を取得した後、慌てて解除せず、重要なモジュールやアプリケーションがオフラインか異常か、リモコンが緊急停止モードに入ったかどうかを検出し、上記のような場合は、すべての制御情報をゼロにする、つまりモーターなどの作動ユニットを静止させる
5. 最後に、pubsubメカニズムを通して、他のアプリケーションが取得できるように、特定の制御情報を対応するトピックに公開する。 デュアルボードの場合、シャーシにプッシュされる情報はCANComm経由で送信されます。

### リモートコントロールモード。

ホイールを下へトグルすると緊急停止モードに入る（その後、デーモンを使用して、リモートコントロール停止を閉じるように変更）; ホイールを上にトグルするとフリクションホイールが開き、半分以上で発射を開始する（スピードリング、連続発射）

左のスイッチ
- 上：キーボードとマウス操作
- 中：ビジュアルコントロール（ターゲットを認識しない場合でも、リモコンを使ってジンバルをコントロールできる）
- 下：リモコン

右のスイッチ
- 上：ボムベイオープン
- 中：シャーシとジンバルの分離（シャーシは回転せず、全方位に動く）
- 下：シャシーがジンバルに追従する

### キーパッド制御モード。

リモコンの左スイッチを上に切り替えると、キーボードとマウスのコントロールモードになり、この時、リモコンのリモートセンシングとダイヤルホイールの入力には反応しません。

前後左右：WSAD

ハッチ開閉：R

小型ジャイロ(無限回転？)：Q

発射：マウス左ボタン

自己照準：マウス右ボタン